server {
  listen 80;

  # Use writable temp paths to avoid permission errors
  client_body_temp_path /tmp/nginx/client_temp;
  proxy_temp_path       /tmp/nginx/proxy_temp;
  fastcgi_temp_path     /tmp/nginx/fastcgi_temp;
  scgi_temp_path        /tmp/nginx/scgi_temp;
  uwsgi_temp_path       /tmp/nginx/uwsgi_temp;

  # Proxy API calls to the appropriate backend services
  location /products/ {
    proxy_pass http://products-service/products/;
  }

  location /users/ {
    proxy_pass http://users-service/api/auth/;
  }

  # Serve the React app and handle SPA routing
  location / {
    root /usr/share/nginx/html;
    index index.html index.htm;
    try_files $uri $uri/ /index.html =404;
  }
}